# 실제 안전 문서 없이 테스트하는 전략

**날짜**: 2026년 1월 27일
**목적**: 2월 7일 데모 준비를 위한 종합 테스트 가이드

---

## 개요

실제 한국 건설 안전 문서가 없으므로 세 가지 접근 방식을 사용합니다:

1. **합성 문서** - 프로그래밍 방식으로 현실적인 테스트 문서 생성
2. **수동 모의 문서** - 현실적인 PDF/이미지를 수동으로 생성
3. **브라우저 테스트** - 스크린샷 업로드 및 텍스트 입력으로 테스트

---

## 방법 1: 합성 테스트 데이터 (프로그래밍 방식)

### 이미 사용 가능: `src/lib/testData.ts`

이 파일에는 현실적인 테스트 문서를 생성하는 함수가 포함되어 있습니다:

```typescript
// 문제 없는 유효한 문서
const validDoc = generateValidDocument();

// 모순이 있는 문서 (Stage 2 테스트)
const contradictoryDoc = generateContradictoryDocument();

// 의심스러운 패턴이 있는 문서 (Stage 4 테스트)
const suspiciousDoc = generateAlwaysCheckDocument("김만점", 0);

// 위험도가 불일치하는 문서 (Stage 3 테스트)
const inconsistentDoc = generateInconsistentRiskDocument();
```

---

## 방법 2: 모의 PDF 문서 만들기

### 옵션 A: Google 문서/MS Word 사용

한국어 안전 체크리스트 문서 만들기:

1. **헤더 섹션**:
   ```
   안전점검표 (Safety Inspection Checklist)

   점검일자: 2026-01-27
   현장명: 김포 한강신도시 A공구
   작업내용: 철골 구조물 설치 작업
   작업인원: 5명
   ```

2. **체크리스트 섹션**:
   ```
   [ ✓ ] 1. 안전모 착용
   [ ✓ ] 2. 고소작업 실시
   [ ✗ ] 3. 안전대 착용  ← 위반 발생!
   [ ✓ ] 4. 화기작업 실시
   [ ✗ ] 5. 소화기 비치  ← 또 다른 위반!
   ```

3. **서명 섹션**:
   ```
   담당자: [서명] 김철수
   소장: [서명] 박현장
   ```

4. **PDF로 내보내기**하고 앱에 업로드

### 옵션 B: 한국 문서 템플릿 사용

검색어:
- "산업안전 점검표 양식"
- "TBM 기록표"
- "위험성 평가 보고서"

템플릿을 다운로드하고 테스트 데이터로 채운 다음 PDF로 저장합니다.

---

## 방법 3: 스크린샷 테스팅 (가장 쉬움!) ⭐

### 대화형 HTML 도구 사용

**파일**: `tools/generate-test-document.html`

**사용 방법**:
1. 파일을 브라우저에서 열기
2. 프리셋 버튼 클릭 (예: "Violation")
3. "PDF로 저장" 클릭 또는 스크린샷 찍기
4. 앱에 업로드

**4가지 프리셋 시나리오**:

#### 1. ✅ Valid (정상)
- 모든 검사 통과
- 위반 없음
- 서명 모두 있음

#### 2. ❌ Violation (위반)
- 고소작업(✔) + 안전대 미착용(✗) → 위반!
- 화기작업(✔) + 소화기 없음(✗) → 위반!
- 3개 이상의 오류 감지 예상

#### 3. ⚠️ Contradiction (모순)
- 고소작업 안 함(✗) + 추락방호장치 있음(✔) → 모순!
- 화기작업 안 함(✗) + 소화기 있음(✔) → 모순!
- 논리적 불일치 경고 예상

#### 4. ❓ N/A Pattern (N/A 패턴)
- 모든 항목이 N/A로 표시
- 점검자: "김만점"
- 소장 서명 누락
- "의심스러운 패턴" 경고 예상

---

## 각 단계별로 테스트하기

### Stage 1: 형식 검증
**테스트**: 필수 필드가 누락된 문서 업로드

**만들기**: 날짜나 서명이 없는 문서
```
예상되는 문제:
- "점검일자 누락"
- "담당자 서명 누락"
- "관리책임자 서명 미비"
```

### Stage 2: 문서 내 논리 검증
**테스트**: 모순되는 체크리스트가 있는 문서 업로드

**만들기**:
- 고소작업 (✔) + 안전대 없음 (✗) → 오류
- 고소작업 안 함 (✗) + 추락방호장치 있음 (✔) → 경고

```
예상되는 문제:
- "안전규정 위반 - 고소작업 시 안전대 착용 필수"
- "논리적 불일치 - 고소작업 미실시이나 추락방호장치 사용"
```

### Stage 3: 문서 간 일관성
**테스트**: 마스터 플랜으로 프로젝트 생성 후 모순되는 문서 업로드

**단계**:
1. 마스터 플랜 텍스트로 프로젝트 생성:
   ```
   이 현장은 고위험 작업 현장입니다.
   - 모든 작업은 고소작업으로 분류
   - 안전대 및 추락방호망 필수
   - 화기작업 시 소화기 2개 이상 비치
   ```

2. 다음과 같이 기재된 문서 업로드:
   - 위험도: 낮음
   - 작업: "일상 점검"

```
예상: 불일치에 대한 AI 채팅 메시지 경고
```

### Stage 4: 행동 패턴 분석
**테스트**: 같은 점검자 이름으로 여러 문서 제출

**단계**:
1. 점검자 이름 "김만점"으로 6개 문서 업로드
2. 모든 문서의 체크리스트 항목이 100% ✔
3. 6번째 문서에서 패턴 경고가 나타나야 함

```
예상되는 문제:
- "패턴 경고: 일관된 전체 체크"
- "이 점검자는 최근 6건에서 100%를 ✔로 표시"
```

### Stage 5: 위험 신호 안내
**테스트**: 패턴 경고에 보라색 스타일링이 있는지 확인

**단계**:
1. 패턴 경고 트리거 (Stage 4)
2. UI에서 빨간색/주황색 대신 보라색 아이콘/테두리 표시 확인

```
예상:
- 보라색 query_stats 아이콘
- 보라색 테두리 (border-l-purple-500)
- 제목: "패턴 경고: ..."
```

---

## 빠른 테스트 스크립트 (브라우저 콘솔)

파일 업로드 없이 빠른 테스트를 위해 브라우저 콘솔 사용:

```javascript
// 앱에서 브라우저 콘솔 열기
// 모의 문서 생성
const mockDoc = {
  docType: "산업안전 점검표",
  fields: {
    점검일자: "2026-01-27",
    현장명: "테스트 현장",
    작업내용: "철골 설치",
    작업인원: "5명"
  },
  signature: {
    담당: "present",
    소장: "present"
  },
  checklist: [
    { id: "fall_01", category: "추락예방", nameKo: "고소작업", value: "✔" },
    { id: "ppe_03", category: "보호구", nameKo: "안전대착용", value: "✖" }
  ]
};

// 검증 API로 전송
fetch('/api/validate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    provider: 'auto',
    fileName: 'test.pdf',
    pdfText: JSON.stringify(mockDoc),
    pageImages: null,
    projectId: null
  })
}).then(r => r.json()).then(console.log);
```

---

## 권장 테스트 순서

### 1일차: 기본 검증 (Stage 1 + 2)
1. 유효한 문서 테스트 → 0개의 문제로 통과해야 함
2. 필수 필드 누락 테스트 → 3-5개의 문제 플래그되어야 함
3. 안전 위반 테스트 → 특정 규칙 플래그되어야 함
4. 모순 테스트 → 논리적 문제 플래그되어야 함

### 2일차: 패턴 테스팅 (Stage 4)
1. 동일한 문서 10개 제출 → "always ✔" 경고 트리거해야 함
2. 5분 안에 5개 문서 제출 → "빠른 완료" 트리거해야 함
3. 같은 작업 내용 4번 사용 → "복사-붙여넣기" 트리거해야 함

### 3일차: 통합 테스팅 (Stage 3)
1. 다른 마스터 플랜으로 3개 프로젝트 생성
2. 각각에 모순되는 문서 업로드
3. AI가 불일치를 올바르게 플래그하는지 확인

### 4일차: UI/UX 테스팅
1. 모바일에서 테스트 (반응형 디자인)
2. 다크 모드 테스트
3. 드래그-리사이즈 기능 테스트
4. 프로젝트 전환 테스트

### 5일차: 데모 리허설
1. 3개의 데모 문서 준비 (유효, 위반, 패턴)
2. 전체 워크플로 연습: 프로젝트 생성 → 업로드 → 검토
3. 데모 시간 재기 (5분 미만이어야 함)

---

## 샘플 테스트 케이스 매트릭스

| 테스트 케이스 | 문서 유형 | 예상되는 문제 | 단계 |
|-----------|-----------|--------------|------|
| 유효한 문서 | 모두 ✔인 점검표 | 0개 오류, 아마도 1개 정보 | 1 |
| 날짜 누락 | 날짜 없는 점검표 | "점검일자 누락" | 1 |
| 서명 누락 | 담당 서명 없는 점검표 | "담당자 서명 누락" | 1 |
| 고소작업+안전대없음 | 점검표: fall_01=✔, ppe_03=✗ | "안전대 착용 필수" | 2 |
| 화기+소화기없음 | 점검표: fire_01=✔, fire_02=✗ | "소화기 비치 필수" | 2 |
| 모순 | 점검표: fall_01=✗, fall_02=✔ | "기록 불일치" | 2 |
| N/A 과다 | 60% N/A인 점검표 | "N/A 과다 표시" | 2 |
| 전체 체크 | 100% ✔인 점검표 | "전체 항목 적합 표시" (정보) | 2 |
| 프로젝트 불일치 | 고위험 작업을 저위험으로 표시 | AI 채팅 경고 | 3 |
| Always Check 패턴 | "김만점"의 6개 문서 모두 ✔ | "일관된 전체 체크" (보라색) | 4 |
| 복사-붙여넣기 패턴 | "일상 점검"인 4개 문서 | "동일 작업내용 반복" (보라색) | 4 |
| 빠른 완료 | 10분 안에 5개 문서 | "빠른 연속 제출" (보라색) | 4 |

---

## 데모 당일 준비

### 데모 전날 (2월 6일)
- [ ] 3개의 테스트 PDF 생성 (유효, 위반, 패턴)
- [ ] 마스터 플랜으로 2개의 테스트 프로젝트 생성
- [ ] 패턴 감지를 위해 5개의 보고서 미리 로드
- [ ] 발표용 노트북에서 테스트
- [ ] 백업 스크린샷 준비 (인터넷 장애 대비)

### 데모 스크립트 (5분)
1. **소개** (30초): 5단계 프레임워크 설명
2. **Stage 1-2 데모** (2분): 위반 문서 업로드, 오류 표시
3. **Stage 3 데모** (1분): 프로젝트 컨텍스트 확인 표시
4. **Stage 4 데모** (1분): 보라색 스타일링으로 패턴 경고 표시
5. **결론** (30초): 실제 영향 설명

---

## 문제 해결

### 문제: AI가 한국어 텍스트를 올바르게 추출하지 못함
**해결책**: 더 명확한 글꼴, 더 높은 해상도 스크린샷 사용

### 문제: 패턴 경고가 나타나지 않음
**해결책**: 데이터베이스에 같은 점검자의 보고서가 최소 5개 필요

### 문제: 프로젝트 컨텍스트가 작동하지 않음
**해결책**: projectId가 검증 API에 전달되는지 확인

### 문제: 업로드 후 UI가 업데이트되지 않음
**해결책**: 브라우저 콘솔에서 오류 확인, API 응답 확인

---

## 요약

**가장 쉬운 테스트 방법**:
1. 한국어 체크리스트로 HTML 파일 생성
2. 스크린샷 찍기
3. 앱에 스크린샷 업로드
4. 검증 결과 확인

**가장 현실적인 방법**:
1. 인터넷에서 한국 안전 템플릿 다운로드
2. 테스트 데이터로 채우기
3. PDF로 저장
4. 앱에 업로드

**데모용**:
- 3개의 미리 만든 문서 준비
- 백업 스크린샷 보유
- 워크플로를 3-5회 연습
- 데모를 5분 이내로 유지

**핵심 인사이트**: 실제 문서가 필요하지 않습니다 - 의도적인 오류가 있는 현실적인 모의 문서가 모든 검증 단계를 효과적으로 시연할 것입니다!

---

**작성자**: Claude Sonnet 4.5
**날짜**: 2026년 1월 27일
**브랜치**: `feat/complete-validation-system`
